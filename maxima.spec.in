# -*- mode: rpm-spec -*-

# By default, this spec file will generate RPMs for Clisp, CMUCL
# and GCL. This can be changed by modifying the variables below.
%define enable_clisp 1
%define clisp_flags --enable-clisp
%define clisp_version 2.29
%define enable_cmucl 1
%define cmucl_flags --enable-cmucl
%define enable_sbcl 1
%define sbcl_flags --enable-sbcl
%define enable_gcl 1
%define gcl_flags --enable-gcl

# Inhibit automatic compressing of info files. Compressed info
# files break maxima's internal help.
%define __spec_install_post /bin/true

Summary: Maxima Symbolic Computation Program
Name: maxima
Version: @VERSION@
Release: 1
License: GPL
Group: Development/Languages
URL: http://maxima.sourceforge.net
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-buildroot
Requires: maxima_exec

%description

Maxima is a full symbolic computation program.  It is full featured
doing symbolic manipulation of polynomials, matrices, rational
functions, integration, Todd-coxeter, graphing, bigfloats.  It has a
symbolic debugger source level debugger for maxima code.  Maxima is
based on the original Macsyma developed at MIT in the 1970's.  It is
quite reliable, and has good garbage collection, and no memory leaks.
It comes with hundreds of self tests.

%package xmaxima
Summary: Tcl/Tk interface to Maxima
Group: Development/Languages
Requires: maxima tk
Provides: xmaxima
%description xmaxima
Tcl/Tk interface to Maxima.

%if %{enable_clisp}
%package exec-clisp
Summary: Maxima compiled with clisp
Group: Development/Languages
Requires: clisp = %{clisp_version}, maxima
Provides: maxima_exec
%description exec-clisp
Maxima compiled with clisp.
%endif

%if %{enable_cmucl}
%package exec-cmucl
Summary: Maxima compiled with CMUCL
Group: Development/Languages
Requires: cmucl maxima
Provides: maxima_exec
%description exec-cmucl
Maxima compiled with CMUCL.
%endif

%if %{enable_sbcl}
%package exec_sbcl
Summary: Maxima compiled with SBCL
Group: Development/Languages
Requires: sbcl maxima
Provides: maxima_exec
%description exec_sbcl
Maxima compiled with SBCL.
%endif

%if %{enable_gcl}
%package exec-gcl
Summary: Maxima compiled with GCL
Group: Development/Languages
Requires: maxima
Provides: maxima_exec
%description exec-gcl
Maxima compiled with Gnu Common Lisp.
%endif

%prep
%setup -q
%configure  %{?sbcl_flags:} %{?cmucl_flags:} %{?gcl_flags:} %{?clisp_flags:}

%build
make

%install
rm -rf $RPM_BUILD_ROOT
%makeinstall

%post
/sbin/install-info %{_infodir}/maxima.info %{_infodir}/dir

%postun
if [ "$1" = 0 ]; then
	/sbin/install-info --delete %{_infodir}/maxima.info %{_infodir}/dir
fi

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%{_datadir}/maxima/%{version}/*
%{_libexecdir}/maxima/%{version}
%{_infodir}/*
%{_mandir}/man1/maxima.1
%{_bindir}/maxima
%doc AUTHORS COPYING COPYING1 INSTALL README README.lisps README.rpms

%files xmaxima
%{_bindir}/xmaxima

%if %{enable_clisp}
%files exec-clisp
%{_libdir}/maxima/%{version}/binary-clisp/*
%endif

%if %{enable_cmucl}
%files exec-cmucl
%{_libdir}/maxima/%{version}/binary-cmucl/*
%endif

%if %{enable_sbcl}
%files exec_sbcl
/usr/lib/maxima/%{version}/binary-sbcl/*
%endif

%if %{enable_gcl}
%files exec-gcl
%{_libdir}/maxima/%{version}/binary-gcl/*
%endif

%doc


%changelog
* Sat Jan  4 2003 James Amundson <amundson@fnal.gov>
- Added doc files
- Added explicit clisp version
- Added conditional to postun
- Renamed exec_* packages to exec-*
- Use rpm macros instead of hard-coded paths
- Thanks to Rex Dieter for helpful suggestions

* Sun Sep  8 2002 James Amundson <amundson@fnal.gov> 
- Initial build.
