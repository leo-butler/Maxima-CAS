# -*- mode: rpm-spec -*-

# By default, this spec file will generate RPMs for clisp
# This can be changed by modifying the variables below.
%define enable_clisp 1
%define clisp_flags --enable-clisp
%define enable_cmucl 0
%define cmucl_flags --disable-cmucl
%define enable_sbcl 0
%define sbcl_flags --disable-sbcl
%define enable_gcl 0
%define gcl_flags --disable-gcl

# Options to build language packs
#  Spanish 
%define enable_lang_es 1
%define lang_es_flags --enable-lang-es
#  Spanish UTF-8  
%define enable_lang_es_utf 1
%define lang_es_flags_utf --enable-lang-es-utf8
#  Portuguese
%define enable_lang_pt 1
%define lang_pt_flags --enable-lang-pt
#  Portuguese
%define enable_lang_pt_utf 1
%define lang_pt_flags_utf --enable-lang-pt-utf8

# Inhibit automatic compressing of info files. Compressed info
# files break maxima's internal help.
%define __spec_install_post /bin/true

Summary: Maxima Symbolic Computation Program
Name: maxima
Version: @VERSION@
Release: 1
License: GPL
Group: Development/Languages
URL: http://maxima.sourceforge.net
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-buildroot
Requires: maxima_exec

%description

Maxima is a full symbolic computation program.  It is full featured
doing symbolic manipulation of polynomials, matrices, rational
functions, integration, Todd-coxeter, graphing, bigfloats.  It has a
symbolic debugger source level debugger for maxima code.  Maxima is
based on the original Macsyma developed at MIT in the 1970's.  It is
quite reliable, and has good garbage collection, and no memory leaks.
It comes with hundreds of self tests.

%package xmaxima
Summary: Tcl/Tk interface to Maxima
Group: Development/Languages
Requires: maxima tk
Provides: xmaxima
%description xmaxima
Tcl/Tk interface to Maxima.

%if %{enable_clisp}
%package exec-clisp
Summary: Maxima compiled with clisp
Group: Development/Languages
Requires: maxima
Provides: maxima_exec
%description exec-clisp
Maxima compiled with clisp.
%endif

%if %{enable_cmucl}
%package exec-cmucl
Summary: Maxima compiled with CMUCL
Group: Development/Languages
Requires: maxima
Provides: maxima_exec
%description exec-cmucl
Maxima compiled with CMUCL.
%endif

%if %{enable_sbcl}
%package exec-sbcl
Summary: Maxima compiled with SBCL
Group: Development/Languages
Requires: sbcl maxima
Provides: maxima_exec
%description exec-sbcl
Maxima compiled with SBCL.
%endif

%if %{enable_gcl}
%package exec-gcl
Summary: Maxima compiled with GCL
Group: Development/Languages
Requires: maxima
Provides: maxima_exec
%description exec-gcl
Maxima compiled with Gnu Common Lisp.
%endif

%if %{enable_lang_es}
%package lang-es
Summary: Maxima Spanish language pack
Group: Development/Languages
Requires: maxima
%description lang-es
Maxima Spanish lagnuage support.
%endif

%if %{enable_lang_es_utf}
%package lang-es-utf8
Summary: Maxima Spanish UTF-8 language pack
Group: Development/Languages
Requires: maxima
%description lang-es-utf8
Maxima Spanish lagnuage support (UTF-8).
%endif

%if %{enable_lang_pt}
%package lang-pt
Summary: Maxima Portuguese language pack
Group: Development/Languages
Requires: maxima
%description lang-pt
Maxima Portuguese lagnuage support.
%endif

%if %{enable_lang_pt_utf}
%package lang-pt-utf8
Summary: Maxima Portuguese UTF-8 language pack
Group: Development/Languages
Requires: maxima
%description lang-pt-utf8
Maxima Portuguese lagnuage support (UTF-8).
%endif

%prep
%setup -q
%configure  %{?sbcl_flags:} %{?cmucl_flags:} %{?gcl_flags:} %{?clisp_flags:} \
	    %{?lang_es_flags:} %{?lang_es_flags_utf:} \
	    %{?lang_pt_flags:} %{?lang_pt_flags_utf:} 

%build
make

%install
rm -rf $RPM_BUILD_ROOT
%makeinstall
  make \
	prefix=%{?buildroot:%{buildroot}}%{_prefix} \
	exec_prefix=%{?buildroot:%{buildroot}}%{_exec_prefix} \
	bindir=%{?buildroot:%{buildroot}}%{_bindir} \
	sbindir=%{?buildroot:%{buildroot}}%{_sbindir} \
	sysconfdir=%{?buildroot:%{buildroot}}%{_sysconfdir} \
	datadir=%{?buildroot:%{buildroot}}%{_datadir} \
	includedir=%{?buildroot:%{buildroot}}%{_includedir} \
	libdir=%{?buildroot:%{buildroot}}%{_libdir} \
	libexecdir=%{?buildroot:%{buildroot}}%{_libexecdir} \
	localstatedir=%{?buildroot:%{buildroot}}%{_localstatedir} \
	sharedstatedir=%{?buildroot:%{buildroot}}%{_sharedstatedir} \
	mandir=%{?buildroot:%{buildroot}}%{_mandir} \
	infodir=%{?buildroot:%{buildroot}}%{_infodir} \
  install-info
touch debugfiles.list
#  Deal with info/dir
rm -f $RPM_BUILD_ROOT%{_datadir}/info/dir

%post
/sbin/install-info %{_infodir}/maxima.info %{_infodir}/dir

%postun
if [ "$1" = 0 ]; then
	/sbin/install-info --delete %{_infodir}/maxima.info %{_infodir}/dir
fi

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%dir %{_datadir}/maxima
%{_datadir}/maxima/%{version}
%exclude %{_datadir}/maxima/%{version}/doc/html/es
%exclude %{_datadir}/maxima/%{version}/doc/html/pt
%dir %{_libexecdir}/maxima
%{_libexecdir}/maxima/%{version}
%{_infodir}/*
%exclude %{_infodir}/es
%exclude %{_infodir}/pt
%{_mandir}/man1/maxima.1
%{_bindir}/maxima
%{_bindir}/rmaxima
%doc AUTHORS COPYING INSTALL README README.lisps README.rpms

%files xmaxima
%{_bindir}/xmaxima
%{_datadir}/maxima/%{version}/xmaxima

%if %{enable_clisp}
%files exec-clisp
%{_libdir}/maxima/%{version}/binary-clisp
%endif

%if %{enable_cmucl}
%files exec-cmucl
%{_libdir}/maxima/%{version}/binary-cmucl
%endif

%if %{enable_sbcl}
%files exec-sbcl
/usr/lib/maxima/%{version}/binary-sbcl
%endif

%if %{enable_gcl}
%files exec-gcl
%{_libdir}/maxima/%{version}/binary-gcl
%endif

%if %{enable_lang_es}
%files lang-es
%{_datadir}/maxima/%{version}/doc/html/es
%{_infodir}/es
%endif

%if %{enable_lang_es_utf}
%files lang-es-utf8
%{_datadir}/maxima/%{version}/doc/html/es.utf8
%{_infodir}/es.utf8
%endif

%if %{enable_lang_pt}
%files lang-pt
%{_datadir}/maxima/%{version}/doc/html/pt
%{_infodir}/pt
%endif

%if %{enable_lang_pt_utf}
%files lang-pt-utf8
%{_datadir}/maxima/%{version}/doc/html/pt.utf8
%{_infodir}/pt.utf8
%endif

%doc


%changelog
* Wed Dec 28 2005 Vadim Zhytnikov <vvzhy@natorn.ru>
- Spanish and Portuguese language packs.
- Package maxima subdirectories for clean uninstall.

* Sat Jan  4 2003 James Amundson <amundson@fnal.gov>
- Added doc files
- Added explicit clisp version
- Added conditional to postun
- Renamed exec_* packages to exec-*
- Use rpm macros instead of hard-coded paths
- Thanks to Rex Dieter for helpful suggestions

* Sun Sep  8 2002 James Amundson <amundson@fnal.gov> 
- Initial build.
