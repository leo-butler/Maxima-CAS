/* Test cases for ode1_abel.mac functions */

(load("contrib_ode"),use_pdiff:false,put('contrib_ode,true,'verbose));
true;

/* Print ode number*/
(pn_(n_):=print("ODE ",n_),kn_(n_):=print("Kamke ODE ",n_),true);
true;

/* Murphy 78 Abel */
(pn_(78),ans:ode1_abel(eqn:'diff(y,x)+(a*x+y)*y^2=0,y,x));
false;

/* Murphy 79 Abel */
(pn_(79),ans:ode1_abel(eqn:'diff(y,x)+(a*exp(x)+y)*y^2=0,y,x));
false;

/* about the simplest Abel equation - Case g.i*/
/* This solves using ode1_abel_f0_0_f1_0 but not ode1_abel_absolute_invariant_constant */
ans:ode1_abel(eqn:'diff(y,x)=(x+c)*y^3+y^2,y,x);
-(sqrt(3)*log((x+c)^2*y^2+(x+c)*y+1)+2*atan((2*(x+c)*y+1)/sqrt(3))-2*sqrt(3)*log((x+c)*y))/(2*sqrt(3))=log(x+c)+%c;
subst(y,y(x),diff(subst(y(x),y,ans),x));
-(sqrt(3)*(2*(x+c)^2*y*'diff(y,x,1)+(x+c)*'diff(y,x,1)+2*(x+c)*y^2+y)/((x+c)^2*y^2+(x+c)*y+1)+2*(2*(x+c)*'diff(y,x,1)+2*y)/(sqrt(3)*((2*(x+c)*y+1)^2/3+1))-2*sqrt(3)*((x+c)*'diff(y,x,1)+y)/((x+c)*y))/(2*sqrt(3))=1/(x+c);
solve(%,'diff(y,x));
['diff(y,x,1) = (x+c)*y^3+y^2];
lhs(eqn)-rhs(eqn),%;
0;

/* Tests for case g.i */
ans:ode1_abel(eqn:'diff(y,x)=2*x^3*y^3+2*x*y^2,y,x);
-(sqrt(3)*log(x^4*y^2+x^2*y+1)+2*atan((2*x^2*y+1)/sqrt(3))-2*sqrt(3)*log(x^2*y))/(4*sqrt(3))=log(x)+%c;
subst(y,y(x),diff(subst(y(x),y,ans),x));
-(sqrt(3)*(2*x^4*y*'diff(y,x,1)+x^2*'diff(y,x,1)+4*x^3*y^2+2*x*y)/(x^4*y^2+x^2*y+1)+2*(2*x^2*'diff(y,x,1)+4*x*y)/(sqrt(3)*((2*x^2*y+1)^2/3+1))-2*sqrt(3)*(x^2*'diff(y,x,1)+2*x*y)/(x^2*y))/(4*sqrt(3))=1/x;
solve(%,'diff(y,x));
['diff(y,x,1) = 2*x^3*y^3+2*x*y^2];
lhs(eqn)-rhs(eqn),%;
0;

/* and now some cases with relative invariant = 0.  All generated by solving 
   for f[0] for "random" f[1],f[2],f[3] 
*/
ans:ode1_abel(eqn:'DIFF(y,x,1)=x*y^3+x*y^2+y+(9*x^2-2*x^3)/(27*x^2),y,x);
y=%E^(x-x^2/6)/SQRT(%C-2*'INTEGRATE(x*%E^(2*(x-x^2/6)),x))-1/3;
ode_check(eqn,ans);
0;

ans:ode1_abel(eqn:'diff(y,x,1)=y^3/x+y,y,x);
y=%e^x/sqrt(%c-2*'integrate(%e^(2*x)/x,x));
ode_check(eqn,ans);
0;

ans:ode1_abel(eqn:'diff(y,x,1)=y^3+x^2*y,y,x);
y=%e^(x^3/3)/sqrt(%c-2*'integrate(%e^(2*x^3/3),x));
ode_check(eqn,ans);
0;

ans:ode1_abel(eqn:'diff(y,x,1)=x^2*y^3+x*y,y,x);
y=%e^(x^2/2)/sqrt(%c-2*(sqrt(%pi)*%i*erf(%i*x)/4+x*%e^x^2/2));
ode_check(eqn,ans);
0;

/* Cheb-Terrab and Roche (31) */
ans:ode1_abel(eqn:'diff(y,x)=y^3/x+y^2,y,x);
false;

/* Cheb-Terrab and Roche (33) */
ans:ode1_abel(eqn:'diff(y,x)=(x+1/x+1/x^3)*y^3/x+y^2,y,x);
false;

/* According to Cheb-Terrab and Roche, the following 
   equations from kamke have constant invariant */

/* Kamke 38 - Chini invariant constant - 1/(8*a*b^2) 

   One integrable case is a:-1/6  b:1/3
*/

(kn_(38),a:-1/6,b:1/3,ans:ode1_abel(eqn:'diff(y,x) - a*y^3 - b*x^(-3/2),y,x));
 [-LOG(3*SQRT(x)*y+3)/3+LOG(3*SQRT(x)*y/2-3)/3+3/(3*SQRT(x)*y+3)+3*LOG(x)/2+LOG(1/(54*x^3))/3=%C];
subst(y,y(x),diff(subst(y(x),y,ans[1]),x));
-(3*SQRT(x)*'DIFF(y,x,1)+3*y/(2*SQRT(x)))/(3*(3*SQRT(x)*y+3))-3*(3*SQRT(x)*'DIFF(y,x,1)+3*y/(2*SQRT(x)))/(3*SQRT(x)*y+3)^2+(3*SQRT(x)*'DIFF(y,x,1)/2+3*y/(4*SQRT(x)))/(3*(3*SQRT(x)*y/2-3))+1/(2*x)=0;
solve(%,'diff(y,x));
['DIFF(y,x,1) = -(x^2*y^3-2*SQRT(x))/(6*x^2)];
ratsimp(ev(eqn,%));
0;
kill(a,b);
done;

/* Kamke 41 f0=f1=0 */ 
assume(b^2>0,(b^2+4*a)>0);
[b^2>0,(b^2+4*a)>0];
(kn_(41),ans:ode1_abel(eqn:'diff(y,x) + a*x*y^3 + b*y^2 ,y,x));
-(b*LOG(-(-2*a*x*y+SQRT(b^2+4*a)-b)/(2*a*x*y+SQRT(b^2+4*a)+b))+SQRT(b^2+4*a)*(LOG(a^2*x^2*y^2+a*b*x*y-a)-2*LOG(a*x*y/b)))/(2*SQRT(b^2+4*a))=LOG(x)+%C;

subst(y,y(x),diff(subst(y(x),y,ans),x));
-(SQRT(b^2+4*a)*((2*a^2*x^2*y*'DIFF(y,x,1)+a*b*x*'DIFF(y,x,1)+2*a^2*x*y^2+a*b*y)/(a^2*x^2*y^2+a*b*x*y-a)-2*b*(a*x*'DIFF(y,x,1)/b+a*y/b)/(a*x*y))-b*(2*a*x*y+SQRT(b^2+4*a)+b)*((-2*a*x*y+SQRT(b^2+4*a)-b)*(2*a*x*'DIFF(y,x,1)+2*a*y)/(2*a*x*y+SQRT(b^2+4*a)+b)^2-(-2*a*x*'DIFF(y,x,1)-2*a*y)/(2*a*x*y+SQRT(b^2+4*a)+b))/(-2*a*x*y+SQRT(b^2+4*a)-b))/(2*SQRT(b^2+4*a))=1/x;
solve(%,'diff(y,x));
['DIFF(y,x,1) = -a*x*y^3-b*y^2];
lhs(eqn)-rhs(eqn),%[1];
0;
forget(b^2>0,(b^2+4*a)>0);
[b^2>0,(b^2+4*a)>0];

/* Kamke 46  relative invariant = 0 */
(kn_(46),a:1,ans:ode1_abel(eqn:'diff(y,x)- x^a*y^3+3*y^2-x^(-a)*y-x^(-2*a)+ a*x^(-a-1),y,x));
y=1/x+1/(sqrt(1/x^2+%c)*x^2);
ode_check(eqn,ans);
0;
kill(a);
done;
assume(a>1);
[a>1];
(kn_(46),ans:ode1_abel(eqn:'diff(y,x)- x^a*y^3+3*y^2-x^(-a)*y-x^(-2*a)+ a*x^(-a-1),y,x));
y=%e^-(2*x^(1-a)/(1-a))/sqrt(%c-2*'integrate(x^a*%e^-(4*x^(1-a)/(1-a)),x))+1/x^a;
ode_check(eqn,ans);
0;
forget(a>1);
[a>1];

/* Kamke 49 */ 
/*(kn_(49),ans:ode1_abel(eqn:'diff(y,x)+a*diff(phi(x),x)*y^3+6*a*phi(x)*y^2+(2*a+1)*y*diff(phi(x),x,2)/diff(phi(x),x) +2*(a+1) ,y,x));
false;*/

/* Kamke 51 */ 
/*(kn_(51),ans:ode1_abel(eqn:'diff(y,x)-(y-f(x))*(y-g(x))*(y-(a*f(x)+b*g(x))/(a+b))*h(x)-'diff(f(x),x)*(y-g(x))/(f(x)-g(x))-'diff(g(x),x)*(y-f(x))/(g(x)-f(x)),y,x));
false;*/

/* Kamke 188 */ 
/* Some choices that are integrable include
    (n:3, b:1, a:n+b);   => K = -27/4
    (n:7, b:2, a:n+b);   => K = -343/36
*/
(kn_(188),n:3,b:1,a:n+b,ans:ode1_abel(eqn:x^(2*n+1)*'diff(y,x)-a*y^3-b*x^(3*n),y,x));
[LOG(-3*y/x^3-3)/3-LOG(3-6*y/x^3)/3+3/(3-6*y/x^3)-2*LOG(x)+LOG(-4/x^3)/3=%C];
subst(y,y(x),diff(subst(y(x),y,ans),x));
[(9*y/x^4-3*'DIFF(y,x,1)/x^3)/(3*(-3*y/x^3-3))-(18*y/x^4-6*'DIFF(y,x,1)/x^3)/(3*(3-6*y/x^3))-3*(18*y/x^4-6*'DIFF(y,x,1)/x^3)/(3-6*y/x^3)^2-3/x=0];
solve(%,'diff(y,x));
['DIFF(y,x,1) = (4*y^3+x^9)/x^7];
eqn,%;
0;

/* Non-constant invariant */
(kn_(36),ans:ode1_abel(eqn:'diff(y,x)+y^3+a*x*y^2,y,x));
false;

(kn_(37),ans:ode1_abel(eqn:'diff(y,x)-y^3-a*exp(x)*y^2,y,x));
false;

(kn_(40),ans:ode1_abel(eqn:'diff(y,x)+3*a*y^3+6*a*x*y^2,y,x));
false;

(kn_(42),ans:ode1_abel(eqn:'diff(y,x)-x*(x+2)*y^3-(x+3)*y^2,y,x));
false;

(kn_(43),ans:ode1_abel(eqn:'diff(y,x)+(3*a*x^2+4*a^2*x+b)*y^3+3*x*y^2,y,x));
false;

(kn_(45),ans:ode1_abel(eqn:'diff(y,x)+2*(a^2*x^3-b^2*x)*y^3+3*b*y^2,y,x));
false;

/* Abel equations of second kind */
(kn_(213),ans:contrib_ode(eqn:(y+1)*'DIFF(y,x)=y+x,y,x));
[-(LOG((2*(x-1)/(y+1)-SQRT(5)+1)/(2*(x-1)/(y+1)+SQRT(5)+1))+SQRT(5)*LOG((x-1)/(y+1)+(x-1)^2/(y+1)^2-1)-2*SQRT(5)*LOG((x-1)/(y+1))/(2*SQRT(5))=LOG(x-1)+%C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
['DIFF(y,x,1) = (y+x)/(y+1)];

(kn_(214),ans:contrib_ode(eqn:(y+x-1)*'DIFF(y,x)-y+2*x+3=0,y,x));
[-(2*ATAN((1-(3*x+2)/(y+x-1))/SQRT(2))+SQRT(2)*LOG(-2*(3*x+2)/(y+x-1)+(3*x+2)^2/(y+x-1)^2+3)-2*SQRT(2)*LOG(-(3*x+2)/(2*(y+x-1))))/(6*SQRT(2))=LOG(3*x+2)/3+%C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
['DIFF(y,x,1) = (y-2*x-3)/(y+x-1)];

(kn_(215),ans:contrib_ode(eqn:(y+2*x-2)*'DIFF(y,x)-y+x+1=0,y,x));
[-(6*ATAN((3-2*(3*x-1)/(y+2*x-2))/SQRT(3))+SQRT(3)*LOG(-(3*x-1)/(y+2*x-2)+(3*x-1)^2/(3*(y+2*x-2)^2)+1)-2*SQRT(3)*LOG(-(3*x-1)/(3*(y+2*x-2))))/(6*SQRT(3))=LOG(3*x-1)/3+%C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
 ['DIFF(y,x,1) = (y-x-1)/(y+2*x-2)];

(kn_(216),ans:contrib_ode(eqn:(y-2*x+1)*'DIFF(y,x)+y+x=0,y,x));
[-(6*ATAN((2*(3*x-1)/(y-2*x+1)+3)/SQRT(3))+SQRT(3)*LOG((3*x-1)/(y-2*x+1)+(3*x-1)^2/(3*(y-2*x+1)^2)+1)-2*SQRT(3)*LOG((3*x-1)/(3*(y-2*x+1))))/(6*SQRT(3))=LOG(3*x-1)/3+%C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
['DIFF(y,x,1) = -(y+x)/(y-2*x+1)];

(kn_(217),ans:contrib_ode(eqn:(y-x^2)*'DIFF(y,x)=x,y,x));
[(2*y-2*x^2-1)*%E^(2*y)/4 = %C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
['DIFF(y,x,1) = x/(y-x^2)];

(kn_(218),ans:contrib_ode(eqn:(y-x^2)*'DIFF(y,x)+4*x*y=0,y,x));
[(2*y+2*x^2)/SQRT(y)=%C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
['DIFF(y,x,1)=-4*x*y/(y-x^2)];

(kn_(220),ans:contrib_ode(eqn:2*y*'DIFF(y,x)-x*y^2-x^3=0,y,x));
[%E^-(x^2/2)*(y^2+x^2+2) = %C];
(dydx:subst(y,y(x),diff(subst(y(x),y,ans),x)),solve(dydx,'diff(y,x)));
['DIFF(y,x,1) = (x*y^2+x^3)/(2*y)];

/* (kn_(221),ans:contrib_ode(eqn:(2*y+x+1)*'DIFF(y,x)-(2*y+x-1)=0,y,x));*/
